# üìã FE Implementation Status - Warehouse APIs (6.13-6.17)

**Ng√†y c·∫≠p nh·∫≠t:** 30/11/2025  
**Status:** üü° **IN PROGRESS**

---

## ‚úÖ ƒê√£ Ho√†n Th√†nh

### 1. Types & Interfaces ‚úÖ

- ‚úÖ **SupplierListDTO** - Match v·ªõi BE (business metrics, blacklist, tier, rating)
- ‚úÖ **SupplierPageResponse** - Pagination response v·ªõi metadata
- ‚úÖ **CreateSupplierRequest** - Match v·ªõi BE (phone field, auto-generate code)
- ‚úÖ **UpdateSupplierRequest** - Match v·ªõi BE (contactPerson, isBlacklisted, isActive)
- ‚úÖ **SupplierFilterRequest** - Advanced filtering cho API 6.13
- ‚úÖ **ServiceConsumablesResponse** - Types cho API 6.17
- ‚úÖ **ConsumableItemResponse** - Types cho consumable items

**Files:**
- `src/types/supplier.ts` - Updated v·ªõi t·∫•t c·∫£ types m·ªõi
- `src/types/serviceConsumable.ts` - Created m·ªõi

---

### 2. Services ‚úÖ

- ‚úÖ **supplierService.getSuppliersWithMetrics()** - API 6.13 implementation
- ‚úÖ **supplierService.create()** - API 6.14 v·ªõi proper field mapping
- ‚úÖ **supplierService.update()** - API 6.15 (ƒë√£ c√≥ s·∫µn, ch·ªâ c·∫ßn verify)
- ‚úÖ **supplierService.delete()** - API 6.16 v·ªõi enhanced error handling (409 Conflict)
- ‚úÖ **serviceConsumableService.getServiceConsumables()** - API 6.17 implementation

**Files:**
- `src/services/supplierService.ts` - Updated
- `src/services/serviceConsumableService.ts` - Created m·ªõi

---

### 3. React Query Hooks ‚úÖ

- ‚úÖ **useSuppliersWithMetrics()** - Hook cho API 6.13
- ‚úÖ **useDeleteSupplier()** - Enhanced error handling cho 409 Conflict

**Files:**
- `src/hooks/useSuppliers.ts` - Updated

---

### 4. Components - SupplierFormModal ‚úÖ

- ‚úÖ Support **contactPerson** field (V30)
- ‚úÖ Support **isBlacklisted** checkbox (risk management)
- ‚úÖ Support **isActive** checkbox (update mode only)
- ‚úÖ Removed **supplierCode** field (auto-generated by BE)
- ‚úÖ Updated validation (phone required, 10-11 digits)
- ‚úÖ Info message v·ªÅ auto-generated code

**Files:**
- `src/app/admin/warehouse/components/SupplierFormModal.tsx` - Updated

---

## ‚úÖ ƒê√£ Ho√†n Th√†nh (Ti·∫øp)

### 5. Components - Suppliers Page ‚úÖ

**ƒê√£ update:**
- ‚úÖ Switch t·ª´ `useSuppliers()` sang `useSuppliersWithMetrics()` (API 6.13)
- ‚úÖ Hi·ªÉn th·ªã business metrics columns: `totalOrders`, `lastOrderDate`
- ‚úÖ Blacklist warning badges/indicators trong table
- ‚úÖ Inactive supplier warnings (> 6 months) v·ªõi badge
- ‚úÖ Advanced filters: `isBlacklisted`, `isActive` dropdowns
- ‚úÖ Sort by business metrics: `totalOrders`, `lastOrderDate`
- ‚úÖ Updated table columns ƒë·ªÉ hi·ªÉn th·ªã metrics
- ‚úÖ Stats card v·ªõi blacklisted count
- ‚úÖ Enhanced delete confirmation message

**Files:**
- `src/app/admin/warehouse/suppliers/page.tsx` - ‚úÖ Updated

---

### 6. Components - SupplierDetailModal ‚úÖ

**ƒê√£ update:**
- ‚úÖ Hi·ªÉn th·ªã business metrics section:
  - Total Orders
  - Last Order Date
  - Tier Level
  - Rating Score
- ‚úÖ Blacklist warning banner (n·∫øu isBlacklisted = true) - Red alert banner
- ‚úÖ Inactive warning (n·∫øu > 6 months kh√¥ng c√≥ ƒë∆°n) - Yellow alert banner
- ‚úÖ Contact Person field (V30) - Hi·ªÉn th·ªã trong contact section

**Files:**
- `src/app/admin/warehouse/components/SupplierDetailModal.tsx` - ‚úÖ Updated

---

### 7. Delete Handler Enhancement ‚úÖ

**ƒê√£ update:**
- ‚úÖ Enhanced error handling trong `supplierService.delete()` ‚úÖ
- ‚úÖ Enhanced error handling trong `useDeleteSupplier()` hook ‚úÖ
- ‚úÖ Update confirmation dialog message ƒë·ªÉ mention transaction history
- ‚úÖ Using `deleteMutation.mutateAsync()` v·ªõi proper error handling

**Files:**
- `src/app/admin/warehouse/suppliers/page.tsx` - ‚úÖ confirmDelete function updated

---

### 8. Service Consumables Integration

**C·∫ßn implement:**
- [ ] Create component ƒë·ªÉ hi·ªÉn th·ªã service consumables
- [ ] Integrate v√†o appointment booking flow
- [ ] Stock status warnings (OUT_OF_STOCK, LOW)
- [ ] Permission-based price display (VIEW_WAREHOUSE_COST)
- [ ] Block booking n·∫øu `hasInsufficientStock = true`

**Files:**
- `src/app/admin/warehouse/components/ServiceConsumablesCard.tsx` - C·∫ßn t·∫°o m·ªõi
- Integration v√†o booking flow - C·∫ßn x√°c ƒë·ªãnh location

---

## üìù Notes

### API 6.13 - Supplier List v·ªõi Metrics

**Endpoint:** `GET /api/v1/warehouse/suppliers/list`

**Features:**
- Multi-field search (name, code, phone, email)
- Filter by `isBlacklisted` (true/false/null)
- Filter by `isActive` (true/false/null)
- Sort by: `supplierName`, `totalOrders`, `lastOrderDate`, `createdAt`, `tierLevel`, `ratingScore`
- Returns business metrics: `totalOrders`, `lastOrderDate`, `isBlacklisted`

**Response Structure:**
```typescript
{
  suppliers: SupplierListDTO[],
  currentPage: number,
  pageSize: number,
  totalElements: number,
  totalPages: number,
  isFirst: boolean,
  isLast: boolean,
  hasNext: boolean,
  hasPrevious: boolean
}
```

---

### API 6.14 - Create Supplier

**Endpoint:** `POST /api/v1/warehouse/suppliers`

**Key Points:**
- `supplierCode` is **auto-generated** (SUP-001, SUP-002, ...)
- Field name: `phone` (not `phoneNumber`) - mapped in service
- Validation: name unique (case-insensitive), email unique if provided

---

### API 6.15 - Update Supplier

**Endpoint:** `PUT /api/v1/warehouse/suppliers/{id}`

**New Fields (V30):**
- `contactPerson` - T√™n ng∆∞·ªùi li√™n h·ªá
- `isBlacklisted` - Risk management flag
- `isActive` - Pause orders temporarily

**Note:** Metrics (`totalOrders`, `lastOrderDate`) are **NOT** updated via this API.

---

### API 6.16 - Delete Supplier

**Endpoint:** `DELETE /api/v1/warehouse/suppliers/{id}`

**Business Rules:**
- Soft delete (sets `isActive=false`)
- **Cannot delete** if supplier has transaction history (409 Conflict)
- Error message: "Cannot delete supplier with id: X. Supplier has transaction history. Use isActive=false to deactivate instead."

---

### API 6.17 - Service Consumables

**Endpoint:** `GET /api/v1/warehouse/consumables/services/{serviceId}`

**Features:**
- Real-time stock status (OK, LOW, OUT_OF_STOCK)
- Cost calculation (COGS)
- Permission-based pricing (VIEW_WAREHOUSE_COST)
- Warning flag (`hasInsufficientStock`)

**RBAC:**
- Users **WITH** `VIEW_WAREHOUSE_COST`: See `unitPrice`, `totalCost`, `totalConsumableCost`
- Users **WITHOUT** `VIEW_WAREHOUSE_COST`: Price fields excluded from JSON

---

## üöÄ Next Steps

1. **Update Suppliers Page** - Switch to API 6.13, add metrics display, filters, warnings
2. **Update SupplierDetailModal** - Add business metrics section, blacklist warnings
3. **Enhance Delete Handler** - Better UX for transaction history error
4. **Create ServiceConsumablesCard** - Component for API 6.17
5. **Integration Testing** - Test all APIs v·ªõi real BE

---

**Last Updated:** 2025-11-30  
**Status:** ‚úÖ **90% Complete** (APIs 6.13-6.16 fully implemented, API 6.17 service created but component not yet integrated)

