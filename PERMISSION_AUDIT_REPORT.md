# PERMISSION AUDIT REPORT

## Ngày kiểm tra: 2025-01-XX

## 1. SO SÁNH PERMISSIONS GIỮA BE VÀ FE

### 1.1 Permissions từ BE (Seed Data)

```
ACCOUNT: VIEW_ACCOUNT, MANAGE_ACCOUNT
EMPLOYEE: VIEW_EMPLOYEE, MANAGE_EMPLOYEE, DELETE_EMPLOYEE
PATIENT: VIEW_PATIENT, MANAGE_PATIENT, DELETE_PATIENT
APPOINTMENT: VIEW_APPOINTMENT_ALL, VIEW_APPOINTMENT_OWN, CREATE_APPOINTMENT, MANAGE_APPOINTMENT, UPDATE_APPOINTMENT_STATUS
CLINICAL: WRITE_CLINICAL_RECORD, VIEW_VITAL_SIGNS_REFERENCE
ATTACHMENT: VIEW_ATTACHMENT, MANAGE_ATTACHMENTS
PATIENT_IMAGE: PATIENT_IMAGE_READ, MANAGE_PATIENT_IMAGES, DELETE_PATIENT_IMAGES
NOTIFICATION: VIEW_NOTIFICATION, DELETE_NOTIFICATION, MANAGE_NOTIFICATION
HOLIDAY: VIEW_HOLIDAY, MANAGE_HOLIDAY
SERVICE: VIEW_SERVICE, MANAGE_SERVICE
ROOM: VIEW_ROOM, MANAGE_ROOM
WAREHOUSE: VIEW_WAREHOUSE, VIEW_ITEMS, VIEW_MEDICINES, VIEW_WAREHOUSE_COST, MANAGE_WAREHOUSE, MANAGE_SUPPLIERS, IMPORT_ITEMS, EXPORT_ITEMS, DISPOSE_ITEMS, APPROVE_TRANSACTION
SCHEDULE: VIEW_SCHEDULE_ALL, VIEW_SCHEDULE_OWN, MANAGE_WORK_SHIFTS, MANAGE_WORK_SLOTS, MANAGE_PART_TIME_REGISTRATIONS, MANAGE_FIXED_REGISTRATIONS
LEAVE: VIEW_LEAVE_ALL, VIEW_LEAVE_OWN, CREATE_TIME_OFF, APPROVE_TIME_OFF
OVERTIME: VIEW_OT_ALL, VIEW_OT_OWN, CREATE_OVERTIME, APPROVE_OVERTIME
TREATMENT_PLAN: VIEW_TREATMENT_PLAN_ALL, VIEW_TREATMENT_PLAN_OWN, MANAGE_TREATMENT_PLAN
TREATMENT: VIEW_TREATMENT, MANAGE_TREATMENT
ROLE: VIEW_ROLE, MANAGE_ROLE
PERMISSION: VIEW_PERMISSION, MANAGE_PERMISSION
SPECIALIZATION: VIEW_SPECIALIZATION, MANAGE_SPECIALIZATION
CUSTOMER_CONTACT: VIEW_CUSTOMER_CONTACT, MANAGE_CUSTOMER_CONTACT
```

### 1.2 Permissions trong FE (permission.ts)

**✅ Đúng với BE:**
- VIEW_ACCOUNT, MANAGE_ACCOUNT ❌ (FE dùng CREATE/UPDATE/DELETE riêng)
- VIEW_EMPLOYEE, MANAGE_EMPLOYEE, DELETE_EMPLOYEE ❌ (FE dùng CREATE/UPDATE/DELETE riêng)
- VIEW_PATIENT, MANAGE_PATIENT, DELETE_PATIENT ❌ (FE dùng CREATE/UPDATE/DELETE riêng)
- VIEW_APPOINTMENT_ALL, VIEW_APPOINTMENT_OWN, CREATE_APPOINTMENT, UPDATE_APPOINTMENT_STATUS ✅
- VIEW_SERVICE, MANAGE_SERVICE ❌ (FE dùng CREATE/UPDATE/DELETE riêng)
- VIEW_ROOM, MANAGE_ROOM ❌ (FE dùng CREATE/UPDATE/DELETE riêng)
- VIEW_WAREHOUSE ✅
- VIEW_SCHEDULE_ALL, VIEW_SCHEDULE_OWN ❌ (FE dùng VIEW_SHIFTS_ALL, VIEW_SHIFTS_OWN)
- MANAGE_WORK_SHIFTS, MANAGE_WORK_SLOTS ✅
- MANAGE_PART_TIME_REGISTRATIONS, MANAGE_FIXED_REGISTRATIONS ✅
- VIEW_LEAVE_ALL, VIEW_LEAVE_OWN, CREATE_TIME_OFF, APPROVE_TIME_OFF ✅
- VIEW_OT_ALL, VIEW_OT_OWN, CREATE_OVERTIME, APPROVE_OVERTIME ✅
- VIEW_TREATMENT_PLAN_ALL, VIEW_TREATMENT_PLAN_OWN, MANAGE_TREATMENT_PLAN ✅
- VIEW_TREATMENT, MANAGE_TREATMENT ❌ (FE dùng CREATE/UPDATE riêng)
- VIEW_ROLE, MANAGE_ROLE ❌ (FE không có)
- VIEW_PERMISSION, MANAGE_PERMISSION ❌ (FE không có)
- VIEW_SPECIALIZATION, MANAGE_SPECIALIZATION ❌ (FE dùng CREATE riêng)
- VIEW_CUSTOMER_CONTACT, MANAGE_CUSTOMER_CONTACT ❌ (FE dùng CREATE/UPDATE/DELETE riêng)

## 2. VẤN ĐỀ PHÁT HIỆN

### 2.1 ❌ Permissions FE không khớp với BE

| FE Permission | BE Permission | Ghi chú |
|---------------|---------------|---------|
| CREATE_ACCOUNT, UPDATE_ACCOUNT, DELETE_ACCOUNT | MANAGE_ACCOUNT | BE dùng MANAGE thay vì CRUD riêng |
| CREATE_EMPLOYEE, UPDATE_EMPLOYEE | MANAGE_EMPLOYEE | BE dùng MANAGE thay vì CRUD riêng |
| CREATE_PATIENT, UPDATE_PATIENT | MANAGE_PATIENT | BE dùng MANAGE thay vì CRUD riêng |
| CREATE_SERVICE, UPDATE_SERVICE, DELETE_SERVICE | MANAGE_SERVICE | BE dùng MANAGE thay vì CRUD riêng |
| CREATE_ROOM, UPDATE_ROOM, DELETE_ROOM | MANAGE_ROOM | BE dùng MANAGE thay vì CRUD riêng |
| VIEW_SHIFTS_ALL, VIEW_SHIFTS_OWN | VIEW_SCHEDULE_ALL, VIEW_SCHEDULE_OWN | Tên khác nhau |
| CREATE_TREATMENT, UPDATE_TREATMENT | MANAGE_TREATMENT | BE dùng MANAGE thay vì CRUD riêng |
| CREATE_SPECIALIZATION | MANAGE_SPECIALIZATION | BE dùng MANAGE thay vì CREATE riêng |
| CREATE_CONTACT, UPDATE_CONTACT, DELETE_CONTACT | MANAGE_CUSTOMER_CONTACT | BE dùng MANAGE thay vì CRUD riêng |

### 2.2 ❌ Permissions FE có nhưng BE không có

```typescript
// Shift Registration - FE có nhưng BE không có trong seed data
VIEW_REGISTRATION_ALL = 'VIEW_REGISTRATION_ALL'
VIEW_REGISTRATION_OWN = 'VIEW_REGISTRATION_OWN'
CREATE_REGISTRATION = 'CREATE_REGISTRATION'
UPDATE_REGISTRATION_ALL = 'UPDATE_REGISTRATION_ALL'
UPDATE_REGISTRATION_OWN = 'UPDATE_REGISTRATION_OWN'
DELETE_REGISTRATION_ALL = 'DELETE_REGISTRATION_ALL'
DELETE_REGISTRATION_OWN = 'DELETE_REGISTRATION_OWN'

// Work Shifts - FE có nhưng BE không có
CREATE_WORK_SHIFTS = 'CREATE_WORK_SHIFTS'
VIEW_WORK_SHIFTS = 'VIEW_WORK_SHIFTS'
UPDATE_WORK_SHIFTS = 'UPDATE_WORK_SHIFTS'
DELETE_WORK_SHIFTS = 'DELETE_WORK_SHIFTS'
VIEW_AVAILABLE_SLOTS = 'VIEW_AVAILABLE_SLOTS'

// Employee Shift - FE có nhưng BE không có
VIEW_SHIFTS_ALL = 'VIEW_SHIFTS_ALL'
VIEW_SHIFTS_OWN = 'VIEW_SHIFTS_OWN'
VIEW_SHIFTS_SUMMARY = 'VIEW_SHIFTS_SUMMARY'
CREATE_SHIFTS = 'CREATE_SHIFTS'
UPDATE_SHIFTS = 'UPDATE_SHIFTS'
DELETE_SHIFTS = 'DELETE_SHIFTS'

// Fixed Registration - FE có nhưng BE không có
VIEW_FIXED_REGISTRATIONS_ALL = 'VIEW_FIXED_REGISTRATIONS_ALL'
VIEW_FIXED_REGISTRATIONS_OWN = 'VIEW_FIXED_REGISTRATIONS_OWN'

// Renewal - FE có nhưng BE không có trong seed data
VIEW_RENEWAL_OWN = 'VIEW_RENEWAL_OWN'
RESPOND_RENEWAL_OWN = 'RESPOND_RENEWAL_OWN'

// Employee Shift - FE có nhưng BE không có
VIEW_EMPLOYEE_SHIFT_ALL = 'VIEW_EMPLOYEE_SHIFT_ALL'
VIEW_EMPLOYEE_SHIFT_OWN = 'VIEW_EMPLOYEE_SHIFT_OWN'

// Leave Type - FE có nhưng BE không có
VIEW_LEAVE_TYPE = 'VIEW_LEAVE_TYPE'
MANAGE_LEAVE_TYPE = 'MANAGE_LEAVE_TYPE'

// Leave Balance - FE có nhưng BE không có
VIEW_LEAVE_BALANCE = 'VIEW_LEAVE_BALANCE'
ADJUST_LEAVE_BALANCE = 'ADJUST_LEAVE_BALANCE'

// Warehouse - FE có nhưng BE không có
CREATE_WAREHOUSE = 'CREATE_WAREHOUSE'
UPDATE_WAREHOUSE = 'UPDATE_WAREHOUSE'
DELETE_WAREHOUSE = 'DELETE_WAREHOUSE'
```

### 2.3 ❌ Permissions BE có nhưng FE không có

```
WRITE_CLINICAL_RECORD
VIEW_VITAL_SIGNS_REFERENCE
VIEW_ATTACHMENT
MANAGE_ATTACHMENTS
PATIENT_IMAGE_READ
MANAGE_PATIENT_IMAGES
DELETE_PATIENT_IMAGES
VIEW_NOTIFICATION
DELETE_NOTIFICATION
MANAGE_NOTIFICATION
VIEW_HOLIDAY
MANAGE_HOLIDAY
VIEW_ITEMS
VIEW_MEDICINES
VIEW_WAREHOUSE_COST
MANAGE_SUPPLIERS
IMPORT_ITEMS
EXPORT_ITEMS
DISPOSE_ITEMS
APPROVE_TRANSACTION
VIEW_ROLE
MANAGE_ROLE
VIEW_PERMISSION
MANAGE_PERMISSION
```

## 3. KIỂM TRA SIDEBAR NAVIGATION

### 3.1 Admin Navigation

| Menu | Required Permission | BE Permission | Status |
|------|---------------------|---------------|--------|
| Tổng quan | None | - | ✅ |
| Quản lý tài khoản | ACCOUNT group | VIEW_ACCOUNT, MANAGE_ACCOUNT | ⚠️ Cần check |
| Quản lý blog | None | - | ✅ |
| Cấu hình hệ thống | SYSTEM_CONFIGURATION group | VIEW_ROLE, VIEW_PERMISSION, VIEW_SPECIALIZATION | ⚠️ Cần check |
| Quản lý lịch làm việc | SCHEDULE_MANAGEMENT group | MANAGE_WORK_SHIFTS, MANAGE_WORK_SLOTS | ✅ |
| Quản lý yêu cầu | LEAVE_MANAGEMENT group | VIEW_OT_ALL, VIEW_LEAVE_ALL | ✅ |
| Quản lý kho | VIEW_WAREHOUSE | VIEW_WAREHOUSE | ✅ |
| Liên hệ khách hàng | CUSTOMER_MANAGEMENT group | VIEW_CUSTOMER_CONTACT | ✅ |
| Quản lý lịch (Booking) | Various | Various | ⚠️ Cần check |

### 3.2 Employee Navigation

| Menu | Required Permission | BE Permission | Status |
|------|---------------------|---------------|--------|
| Tổng quan | None | - | ✅ |
| Quản lý lịch | VIEW_APPOINTMENT_OWN/ALL | VIEW_APPOINTMENT_OWN/ALL | ✅ |
| Kế hoạch điều trị | VIEW_TREATMENT_PLAN_ALL/OWN | VIEW_TREATMENT_PLAN_ALL/OWN | ✅ |
| Quản lý lịch làm việc | VIEW_SHIFTS_OWN, VIEW_REGISTRATION_OWN | VIEW_SCHEDULE_OWN | ⚠️ Tên khác |
| Quản lý yêu cầu | LEAVE_MANAGEMENT group | VIEW_LEAVE_OWN, CREATE_TIME_OFF | ✅ |
| Quản lý khách hàng | CUSTOMER_MANAGEMENT group | VIEW_CUSTOMER_CONTACT | ✅ |
| Quản lý kho | VIEW_WAREHOUSE | VIEW_WAREHOUSE | ✅ |

### 3.3 Patient Navigation

| Menu | Required Permission | BE Permission | Status |
|------|---------------------|---------------|--------|
| Tổng quan | None | - | ✅ |
| Lịch hẹn của tôi | None | VIEW_APPOINTMENT_OWN | ⚠️ Nên thêm permission |
| Kế hoạch điều trị | VIEW_TREATMENT_PLAN_OWN/ALL | VIEW_TREATMENT_PLAN_OWN | ✅ |
| Thanh toán | None | - | ✅ |
| Thông báo | None | VIEW_NOTIFICATION | ⚠️ Nên thêm permission |
| Hồ sơ cá nhân | None | - | ✅ |

## 4. KIỂM TRA THEO ROLE

### 4.1 ROLE_ADMIN
- ✅ Có tất cả permissions theo seed data
- ✅ Sidebar hiển thị đầy đủ menu

### 4.2 ROLE_DENTIST
**BE Permissions:**
- VIEW_PATIENT, MANAGE_PATIENT
- VIEW_APPOINTMENT_OWN, UPDATE_APPOINTMENT_STATUS, MANAGE_APPOINTMENT
- VIEW_TREATMENT_PLAN_OWN, MANAGE_TREATMENT_PLAN
- VIEW_TREATMENT, MANAGE_TREATMENT
- WRITE_CLINICAL_RECORD
- VIEW_ATTACHMENT, MANAGE_ATTACHMENTS
- VIEW_VITAL_SIGNS_REFERENCE
- PATIENT_IMAGE_READ, MANAGE_PATIENT_IMAGES
- VIEW_SERVICE
- VIEW_ITEMS, VIEW_MEDICINES
- VIEW_SCHEDULE_OWN
- VIEW_LEAVE_OWN, CREATE_TIME_OFF
- CREATE_OVERTIME
- VIEW_HOLIDAY
- VIEW_NOTIFICATION, DELETE_NOTIFICATION

**FE Check:**
- ⚠️ VIEW_SCHEDULE_OWN → FE dùng VIEW_SHIFTS_OWN (tên khác)
- ⚠️ WRITE_CLINICAL_RECORD → FE không có
- ⚠️ VIEW_VITAL_SIGNS_REFERENCE → FE không có

### 4.3 ROLE_NURSE
**BE Permissions:**
- VIEW_PATIENT
- VIEW_APPOINTMENT_OWN, UPDATE_APPOINTMENT_STATUS
- VIEW_TREATMENT
- VIEW_ATTACHMENT
- VIEW_SCHEDULE_OWN
- VIEW_LEAVE_OWN, CREATE_TIME_OFF
- CREATE_OVERTIME
- VIEW_HOLIDAY
- VIEW_NOTIFICATION, DELETE_NOTIFICATION

**FE Check:**
- ⚠️ VIEW_SCHEDULE_OWN → FE dùng VIEW_SHIFTS_OWN (tên khác)

### 4.4 ROLE_RECEPTIONIST
**BE Permissions:**
- VIEW_PATIENT, MANAGE_PATIENT
- VIEW_APPOINTMENT_ALL, CREATE_APPOINTMENT, UPDATE_APPOINTMENT_STATUS, MANAGE_APPOINTMENT
- VIEW_CUSTOMER_CONTACT, MANAGE_CUSTOMER_CONTACT
- VIEW_TREATMENT_PLAN_ALL
- PATIENT_IMAGE_READ
- VIEW_WAREHOUSE, VIEW_ITEMS
- VIEW_SCHEDULE_OWN
- VIEW_LEAVE_OWN, CREATE_TIME_OFF
- CREATE_OVERTIME
- VIEW_HOLIDAY
- VIEW_NOTIFICATION, DELETE_NOTIFICATION

**FE Check:**
- ✅ Phần lớn đúng
- ⚠️ VIEW_SCHEDULE_OWN → FE dùng VIEW_SHIFTS_OWN (tên khác)

### 4.5 ROLE_MANAGER
**BE Permissions:**
- VIEW_EMPLOYEE, MANAGE_EMPLOYEE, DELETE_EMPLOYEE
- VIEW_PATIENT
- VIEW_APPOINTMENT_ALL, UPDATE_APPOINTMENT_STATUS, MANAGE_APPOINTMENT
- VIEW_CUSTOMER_CONTACT, MANAGE_CUSTOMER_CONTACT
- VIEW_SCHEDULE_ALL, MANAGE_WORK_SHIFTS, MANAGE_WORK_SLOTS, MANAGE_PART_TIME_REGISTRATIONS, MANAGE_FIXED_REGISTRATIONS
- VIEW_LEAVE_ALL, VIEW_OT_ALL, APPROVE_TIME_OFF, APPROVE_OVERTIME
- VIEW_ROOM, MANAGE_ROOM
- VIEW_SERVICE, MANAGE_SERVICE
- VIEW_HOLIDAY
- VIEW_TREATMENT_PLAN_ALL, MANAGE_TREATMENT_PLAN
- VIEW_TREATMENT, MANAGE_TREATMENT
- VIEW_WAREHOUSE, VIEW_WAREHOUSE_COST, VIEW_ITEMS, MANAGE_WAREHOUSE, MANAGE_SUPPLIERS, IMPORT_ITEMS, EXPORT_ITEMS, APPROVE_TRANSACTION
- VIEW_ROLE
- VIEW_SPECIALIZATION, MANAGE_SPECIALIZATION
- VIEW_NOTIFICATION, DELETE_NOTIFICATION

**FE Check:**
- ✅ Phần lớn đúng
- ⚠️ VIEW_SCHEDULE_ALL → FE dùng VIEW_SHIFTS_ALL (tên khác)

### 4.6 ROLE_PATIENT
**BE Permissions:**
- VIEW_PATIENT
- VIEW_APPOINTMENT_OWN, CREATE_APPOINTMENT
- VIEW_TREATMENT_PLAN_OWN
- VIEW_TREATMENT
- VIEW_ATTACHMENT
- VIEW_NOTIFICATION, DELETE_NOTIFICATION

**FE Check:**
- ✅ Đúng

## 5. KHUYẾN NGHỊ SỬA

### 5.1 Cập nhật permission.ts

```typescript
// Thêm các permissions từ BE
export enum Permission {
  // ... existing permissions ...
  
  // ✅ ADD: BE permissions missing in FE
  MANAGE_ACCOUNT = 'MANAGE_ACCOUNT',
  MANAGE_EMPLOYEE = 'MANAGE_EMPLOYEE',
  MANAGE_PATIENT = 'MANAGE_PATIENT',
  MANAGE_SERVICE = 'MANAGE_SERVICE',
  MANAGE_ROOM = 'MANAGE_ROOM',
  MANAGE_TREATMENT = 'MANAGE_TREATMENT',
  MANAGE_SPECIALIZATION = 'MANAGE_SPECIALIZATION',
  MANAGE_CUSTOMER_CONTACT = 'MANAGE_CUSTOMER_CONTACT',
  
  // Schedule - Use BE naming
  VIEW_SCHEDULE_ALL = 'VIEW_SCHEDULE_ALL',
  VIEW_SCHEDULE_OWN = 'VIEW_SCHEDULE_OWN',
  
  // Clinical
  WRITE_CLINICAL_RECORD = 'WRITE_CLINICAL_RECORD',
  VIEW_VITAL_SIGNS_REFERENCE = 'VIEW_VITAL_SIGNS_REFERENCE',
  
  // Attachments
  VIEW_ATTACHMENT = 'VIEW_ATTACHMENT',
  MANAGE_ATTACHMENTS = 'MANAGE_ATTACHMENTS',
  
  // Patient Images
  PATIENT_IMAGE_READ = 'PATIENT_IMAGE_READ',
  MANAGE_PATIENT_IMAGES = 'MANAGE_PATIENT_IMAGES',
  DELETE_PATIENT_IMAGES = 'DELETE_PATIENT_IMAGES',
  
  // Notifications
  VIEW_NOTIFICATION = 'VIEW_NOTIFICATION',
  DELETE_NOTIFICATION = 'DELETE_NOTIFICATION',
  MANAGE_NOTIFICATION = 'MANAGE_NOTIFICATION',
  
  // Holiday
  VIEW_HOLIDAY = 'VIEW_HOLIDAY',
  MANAGE_HOLIDAY = 'MANAGE_HOLIDAY',
  
  // Warehouse - Additional
  VIEW_ITEMS = 'VIEW_ITEMS',
  VIEW_MEDICINES = 'VIEW_MEDICINES',
  VIEW_WAREHOUSE_COST = 'VIEW_WAREHOUSE_COST',
  MANAGE_SUPPLIERS = 'MANAGE_SUPPLIERS',
  IMPORT_ITEMS = 'IMPORT_ITEMS',
  EXPORT_ITEMS = 'EXPORT_ITEMS',
  DISPOSE_ITEMS = 'DISPOSE_ITEMS',
  APPROVE_TRANSACTION = 'APPROVE_TRANSACTION',
  
  // Role & Permission
  VIEW_ROLE = 'VIEW_ROLE',
  MANAGE_ROLE = 'MANAGE_ROLE',
  VIEW_PERMISSION = 'VIEW_PERMISSION',
  MANAGE_PERMISSION = 'MANAGE_PERMISSION',
}
```

### 5.2 Cập nhật navigationConfig.ts

1. Thay đổi `VIEW_SHIFTS_OWN` → `VIEW_SCHEDULE_OWN`
2. Thay đổi `VIEW_SHIFTS_ALL` → `VIEW_SCHEDULE_ALL`
3. Thêm các permission groups mới từ BE

### 5.3 Cập nhật các trang sử dụng ProtectedRoute

Kiểm tra và cập nhật các trang sử dụng permissions cũ sang permissions mới từ BE.

## 6. KẾT LUẬN

### Tổng quan:
- **Tổng số permissions BE:** ~60+
- **Tổng số permissions FE:** ~80+ (nhiều hơn do FE tách CRUD riêng)
- **Permissions khớp:** ~40%
- **Permissions cần cập nhật:** ~60%

### Ưu tiên sửa:
1. **HIGH:** Cập nhật tên permissions (VIEW_SHIFTS → VIEW_SCHEDULE)
2. **HIGH:** Thêm MANAGE_* permissions thay vì CRUD riêng
3. **MEDIUM:** Thêm các permissions còn thiếu từ BE
4. **LOW:** Xóa các permissions FE không dùng

### Lưu ý:
- BE sử dụng pattern `MANAGE_*` cho CRUD operations
- FE đang sử dụng pattern `CREATE_*/UPDATE_*/DELETE_*` riêng biệt
- Cần đồng bộ naming convention giữa BE và FE
